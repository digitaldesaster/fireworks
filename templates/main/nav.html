<nav class="navbar bg-base-100 flex items-center justify-between p-4">
  <div class="navbar-start">
    <a
      href="{{ url_for('index') }}"
      class="link text-base-content/90 text-xl font-semibold no-underline flex items-center gap-2"
    >
      Fireworks
    </a>
  </div>
  <div class="navbar-end">
    <button
      type="button"
      class="btn btn-text max-lg:btn-square lg:hidden"
      aria-haspopup="dialog"
      aria-expanded="false"
      aria-controls="mobile-menu-overlay"
      data-overlay="#mobile-menu-overlay"
    >
      <span class="icon-[tabler--menu-2] size-5"></span>
    </button>
  </div>
</nav>

<aside
  id="mobile-menu-overlay"
  class="overlay drawer drawer-start max-w-64 lg:fixed lg:top-0 lg:bottom-0 lg:left-0 lg:z-40 lg:flex lg:translate-x-0 overlay-open:translate-x-0 -translate-x-full transition-transform duration-300"
  tabindex="-1"
>
  <div class="drawer-body px-2 pt-4 bg-white h-full">
    <ul class="menu space-y-0.5 p-0">
      <li>
        <a href="{{ url_for('index') }}">
          <span class="icon-[tabler--dashboard] size-5"></span>
          Dashboard
        </a>
      </li>
      <li>
        <a href="{{ url_for('dms_chat.chat') }}">
          <span class="icon-[tabler--message] size-5"></span>
          Chat
        </a>
      </li>
      <li>
        <button
          type="button"
          class="collapse-toggle w-full flex items-center gap-2 px-4 py-2"
          id="prompts-collapse"
          aria-expanded="false"
          aria-controls="prompts-collapse-content"
          data-collapse="#prompts-collapse-content"
        >
          <span class="icon-[tabler--app-window] size-5"></span>
          <span class="flex-1">Prompts</span>
          <span
            class="icon-[tabler--chevron-down] collapse-open:rotate-180 size-4 transition-transform duration-300"
          ></span>
        </button>
        <div
          id="prompts-collapse-content"
          class="collapse hidden w-full overflow-hidden transition-[height] duration-300"
          aria-labelledby="prompts-collapse"
        >
          <ul class="menu space-y-0.5 pl-6" id="prompts-list">
            <li>
              <a href="{{ url_for('list', name='prompts') }}" class="text-sm">
                View All Prompts
              </a>
            </li>
            <!-- Latest prompts will be inserted here -->
          </ul>
        </div>
      </li>
      <li>
        <button
          type="button"
          class="collapse-toggle w-full flex items-center gap-2 px-4 py-2"
          id="history-collapse"
          aria-expanded="false"
          aria-controls="history-collapse-content"
          data-collapse="#history-collapse-content"
        >
          <span class="icon-[tabler--clock] size-5"></span>
          <span class="flex-1">History</span>
          <span
            class="icon-[tabler--chevron-down] collapse-open:rotate-180 size-4 transition-transform duration-300"
          ></span>
        </button>
        <div
          id="history-collapse-content"
          class="collapse hidden w-full overflow-hidden transition-[height] duration-300"
          aria-labelledby="history-collapse"
        >
          <ul class="menu space-y-0.5 pl-6" id="history-list">
            <li>
              <a href="{{ url_for('list', name='history') }}" class="text-sm">
                View All History
              </a>
            </li>
            <!-- Latest history entries will be inserted here -->
          </ul>
        </div>
      </li>

      <div class="divider text-base-content/50 py-6 after:border-0">
        Account
      </div>
      <li>
        <form action="{{ url_for('logout') }}" method="post" class="w-full">
          <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />
          <button
            type="submit"
            class="w-full flex items-center gap-2 px-4 py-2"
          >
            <span class="icon-[tabler--logout-2] size-5"></span>
            Sign Out
          </button>
        </form>
      </li>
    </ul>
  </div>
</aside>

<script>
  // Function to fetch and update nav items
  async function updateNavItems() {
    try {
      const response = await fetch("{{ url_for('dms_chat.get_nav_items') }}");
      const data = await response.json();

      // Clear existing items first
      const promptsList = document.getElementById("prompts-list");
      const historyList = document.getElementById("history-list");

      // Keep the "View All" links
      const promptsViewAll = promptsList.firstElementChild;
      const historyViewAll = historyList.firstElementChild;

      promptsList.innerHTML = "";
      historyList.innerHTML = "";

      // Add back the "View All" links
      promptsList.appendChild(promptsViewAll);
      historyList.appendChild(historyViewAll);

      // Update prompts list
      data.prompts.forEach((prompt) => {
        const li = document.createElement("li");
        li.innerHTML = `
          <div class="flex items-center justify-between">
            <a href="/chat/prompt/${prompt._id.$oid}" class="text-sm">
              ${prompt.name}
            </a>
            <a href="/d/prompt/${prompt._id.$oid}" class="text-sm">
              <span class="icon-[tabler--edit] size-4"></span>
            </a>
          </div>
        `;
        promptsList.appendChild(li);
      });

      // Update history list
      data.history.forEach((item) => {
        const li = document.createElement("li");
        li.innerHTML = `
          <a href="/chat/history/${item._id.$oid}" class="text-sm truncate">
            ${item.first_message || "Untitled Chat"}
          </a>
        `;
        historyList.appendChild(li);
      });
    } catch (error) {
      console.error("Error fetching nav items:", error);
    }
  }

  // Update nav items when the page loads
  document.addEventListener("DOMContentLoaded", updateNavItems);

  // Update nav items every 30 seconds
  setInterval(updateNavItems, 30000);
</script>
